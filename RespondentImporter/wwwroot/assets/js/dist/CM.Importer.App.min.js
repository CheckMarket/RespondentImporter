var CM=CM||{};CM.apps=CM.apps||{},CM.apps.apifactory=function(){function e(e){var n=$.Deferred();return $.getJSON(e).done(function(e){n.resolve(e)}).fail(function(o,t,i){console.error("Api request to '"+e+"' failed"),n.reject(o,t,i)}),n.promise()}return{GetSurveys:function(){return e("/api/surveys")},GetQuestions:function(n){return e("/api/surveys/"+n+"/questions")},GetQuestion:function(n,o){return e("/api/surveys/"+n+"/questions/"+o)}}}();var CM=CM||{};CM.apps=CM.apps||{},CM.apps.importer=function(){function e(e,n){n?($(e).parent(".form-group").removeClass("has-error"),$(e).next(".help-block").remove()):(t=!1,$(e).parent(".form-group").addClass("has-error"),$(e).next(".help-block").length||$(e).parent(".form-group").append("<span class='help-block'>Required</span>"))}function n(){t=!0,$("#frmReadFile #ddlSurveys").trigger("validate"),$("#frmReadFile #uploadFile").trigger("validate"),t&&$("#frmReadFile").submit()}function o(){CM.apps.apifactory.GetSurveys().done(function(e){$.each(e.Data,function(e,n){$("#ddlSurveys").append(["<option value=",n.Id," langs=",n.Langs.join(""),">",n.Title,"</option>"].join(""))})})}var t=!1;return{Initialize:function(){o(),$("#frmReadFile #ddlSurveys").on("change validate",function(){e(this,"0"!=$(this).val())}),$("#frmReadFile #uploadFile").on("change validate",function(){e(this,""!=$(this).val())}),$("#btnSubmit").on("click",function(e){n()})}}}(),CM.apps.configurator=function(){return{Initialize:function(){CM.apps.apifactory.GetQuestions(View.SurveyId).done(function(e){var n="<option value=0>Please select</option>";$.each(e.Data,function(e,o){void 0!=o.SubQuestions?$.each(o.SubQuestions,function(e,o){n+=["<option value=",o.Id,">",o.Caption,"</option>"].join("")}):n+=["<option value=",o.Id,">",o.Caption,"</option>"].join("")}),$("select.question").html(n)}),$("select.question").on("change",function(){var e=$(this).val(),n=$(this).next(".responses");$(n).children("option[value!=0]").remove(),"0"!=e?CM.apps.apifactory.GetQuestion(View.SurveyId,e).done(function(e){var o="<option value=0>Rows contain response</option>";e.Data.QuestionResponses.length>1&&$.each(e.Data.QuestionResponses,function(e,n){o+=["<option value='",n.ResponseId,"'>",n.Caption,"</option>"].join("")}),$(n).html(o).removeClass("hidden")}):$(n).addClass("hidden")})}}}();